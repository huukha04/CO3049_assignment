<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Mazer Admin Dashboard</title>
    
    
    
  <link rel="stylesheet" href="<?=DIST?>assets/compiled/css/app.css">
  <link rel="stylesheet" href="<?=DIST?>assets/compiled/css/app-dark.css">
  <link rel="stylesheet" href="<?=DIST?>assets/compiled/css/iconly.css">

  <link rel="stylesheet" href="<?=DIST?>assets/extensions/simple-datatables/style.css">


</head>

<body>
	<script src="<?=DIST?>assets/static/js/initTheme.js"></script>
    <div id="app">
        <?php include 'sidebar.php'; ?>
        <div id="main">
            
			<header class="navbar mb-3">
				<a href="#" class="burger-btn d-block d-xl-none">
					<i class="bi bi-justify fs-3"></i>
				</a>
				<div class="logo fs-1">
					<a href="<?=ROOT?>home">Move</a>
				</div>
			
				<!--  -->
				<?php include 'dropdown.php'; ?>
			</header>
<div class="page-content"> 
    <section class="section">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    movie
                </h5>
            </div>
            <div class="card-body">
                <div class="h6">Table</div>

                <table class="table table-striped" id="table1">
                    <thead>
                        <tr>
                            <th>Ngày khởi chiếu</th>
                            <th>Tên phim</th>
                            <th>Status</th>
                            <th>URL</th>
                            <th>Remove</th>
                        </tr>
                    </thead>
                    
                    <tbody>

                        <?php if (!empty($movie)): ?>
                            <?php foreach ($movie as $p): ?>
                                <tr>
                                    <td><?= $p->premiere_date; ?></td>
                                    <td><?= $p->title; ?></td>
                                    <td>
                                        <form action="<?=ROOT?>movie/update" method="post">
                                            <input type="hidden" name="id" value="<?= $p->id; ?>">
                                            <input type="hidden" name="status" value="<?= ($p->status == 'active') ? 'inactive' : 'active'; ?>">
                                            <button class="btn <?= ($p->status == 'active') ? 'btn-success' : 'btn-danger'; ?>">
                                                <?= $p->status ?>
                                            </button>
                                        </form>
                                    </td>
                                    <td><?= $p->url; ?></td>
                                    <td>
                                        <form action="<?=ROOT?>movie/delete" method="post">
                                            <input type="hidden" name="id" value="<?= $p->id; ?>">
                                            <button class="btn">
                                                <i class="bi bi-x-circle text-danger"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>

                    </tbody>
                    
                </table>

                <div class="h6">Thêm movie</div>

                <form action="<?=ROOT?>movie/insert" method="post" enctype="multipart/form-data" class="border p-3 rounded">
                    <div class="mb-3">
                        <label for="movie" class="form-label">Chọn ảnh movie</label>
                        <input type="file" id="file" name="file" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="url" class="form-label">URL (mặc định)</label>
                        <input type="text" id="url" name="url" class="form-control" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label  mx-3">Trạng thái</label>
                        <button type="button" id="statusBtn" class="btn btn-danger" onclick="toggleStatus()">Inactive</button>
                        <input type="hidden" id="status" name="status" value="inactive">
                    </div>

                    <div class="mb-3">
                        <label for="title" class="form-label">Tên phim</label>
                        <input type="text" id="title" name="title" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Mô tả</label>
                        <textarea id="description" name="description" class="form-control" rows="3" required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="premiere_date" class="form-label">Ngày khởi chiếu</label>
                        <input type="date" id="premiere_date" name="premiere_date" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="time" class="form-label">Thời lượng (phút)</label>
                        <input type="number" id="time" name="time" class="form-control" required min="1">
                    </div>
                    
                    <div class="mb-3">
                        <label for="category_code" class="form-label">Mã phân loại</label>
                        <input type="text" id="category_code" name="category_code" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="rating" class="form-label">Đánh giá</label>
                        <input type="number" id="rating" name="rating" class="form-control" step="0.1" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="vote_count" class="form-label">Số lượt đánh giá</label>
                        <input type="number" id="vote_count" name="vote_count" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="country" class="form-label">Quốc gia</label>
                        <input type="text" id="country" name="country" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="producer" class="form-label">Nhà sản xuất</label>
                        <input type="text" id="producer" name="producer" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="genre" class="form-label">Thể loại</label>
                        <input type="text" id="genre" name="genre" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="director" class="form-label">Đạo diễn</label>
                        <input type="text" id="director" name="director" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="cast" class="form-label">Diễn viên</label>
                        <textarea id="cast" name="cast" class="form-control" rows="2" required></textarea>
                    </div>
                    
                    <script>
                        function toggleStatus() {
                            let btn = document.getElementById("statusBtn");
                            let input = document.getElementById("status");
                    
                            if (btn.classList.contains("btn-danger")) {
                                btn.classList.remove("btn-danger");
                                btn.classList.add("btn-success");
                                btn.innerText = "Active";
                                input.value = "active";
                            } else {
                                btn.classList.remove("btn-success");
                                btn.classList.add("btn-danger");
                                btn.innerText = "Inactive";
                                input.value = "inactive";
                            }
                        }
                    </script>
                    
                    <?php if (!empty($error)) : ?>
                        <div id="message" class="alert alert-danger h-3" style="visibility: visible;">
                            <?= implode("<br>", array_map('htmlspecialchars', $error)) ?>
                        </div>
                    <?php elseif (!empty($success)) : ?>
                        <div id="message" class="alert alert-success h-3" style="visibility: visible;">
                            <?= implode("<br>", array_map('htmlspecialchars', $success)) ?>
                        </div>
                    <?php endif; ?>


                    <button type="submit" class="btn btn-primary">Tải lên</button>
                </form>

                <script>
                    document.getElementById("file").addEventListener("change", function(event) {
                        let file = event.target.files[0];
                        if (file) {
                            let fileName = file.name;
                            document.getElementById("url").value = "<?=STORAGE?>app/movies/movies/" + fileName;
                        }
                    });
                </script>
                


            </div>
            
            
        </div>

    </section>
</div>

            <?php include 'footer.php'; ?>
        </div>
    </div>
    <script src="<?=DIST?>assets/static/js/components/dark.js"></script>
    <script src="<?=DIST?>assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="<?=DIST?>assets/compiled/js/app.js"></script>
    

    
	<!-- Need: Apexcharts -->
	<script src="<?=DIST?>assets/extensions/apexcharts/apexcharts.min.js"></script>
	<script src="<?=DIST?>assets/static/js/pages/dashboard.js"></script>
    
    
    

    
    <script src="<?=DIST?>assets/extensions/simple-datatables/umd/simple-datatables.js"></script>
    <script src="<?=DIST?>assets/static/js/pages/simple-datatables.js"></script>

    
    

</body>

</html>